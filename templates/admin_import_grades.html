{% extends "_layout.html" %}

{% block title %}Nhập Điểm từ Excel{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">Nhập Điểm hàng loạt từ File Excel</div>
    <div class="card-body">
        <p>Chức năng này cho phép bạn nhập điểm thành phần cho một môn học cụ thể bằng file Excel.</p>

        <div style="background: #fdf8e2; border: 1px solid #f0ad4e; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
            <strong>Yêu cầu file Excel:</strong>
            <ul style="margin-top: 10px; padding-left: 20px; line-height: 1.6;">
                <li>File phải có định dạng <code>.xlsx</code> hoặc <code>.xls</code>.</li>
                <li>
                    <strong>Phải chứa chính xác 5 cột</strong> với tiêu đề (viết thường, không dấu):
                    <ul>
                        <li><code>ma_sinh_vien</code> (Chứa Mã sinh viên)</li>
                        <li><code>diem_chuyen_can</code> (Điểm chuyên cần - thang 10)</li>
                        <li><code>diem_giua_ky</code> (Điểm giữa kỳ - thang 10)</li>
                        <li><code>diem_thuc_hanh</code> (Điểm thực hành - thang 10)</li>
                        <li><code>diem_cuoi_ky</code> (Điểm cuối kỳ - thang 10)</li>
                    </ul>
                </li>
                 <li>Điểm phải là số từ 0 đến 10. Ô điểm trống hoặc sai định dạng sẽ được coi là chưa có điểm (None) cho thành phần đó.</li>
                 <li>Điểm tổng kết (hệ 10) và điểm chữ sẽ được tự động tính theo tỷ lệ của môn khi đủ các cột có trọng số > 0.</li>
                 <li>Mã sinh viên không tồn tại trong hệ thống sẽ bị bỏ qua.</li>
            </ul>
        </div>
        <form method="POST" action="{{ url_for('admin_import_grades') }}" enctype="multipart/form-data">
            <div style="margin-bottom: 15px;">
                <label for="ma_mh">Chọn Môn học cần nhập điểm:</label>
                <select name="ma_mh" id="ma_mh" required style="width: 100%; max-width: 400px;">
                    <option value="">-- Vui lòng chọn --</option>
                    {% for mh in danh_sach_mon_hoc %}
                        <option value="{{ mh.ma_mh }}">{{ mh.ten_mh }} ({{ mh.ma_mh }})</option>
                    {% endfor %}
                </select>
            </div>
            <div style="margin-bottom: 15px;">
                <label for="file">Chọn File Excel chứa điểm:</label><br>
                <input type="file" name="file" id="file" accept=".xls,.xlsx" required
                       style="border: 1px solid #ccc; padding: 10px; width: 100%; max-width: 400px;">
            </div>
            <div style="margin-top: 20px;">
                <input type="submit" value="Tải lên và Nhập điểm"> </div>
        </form>

        <hr style="margin: 25px 0;">
        <a href="{{ url_for('admin_manage_grades') }}">&laquo; Quay lại trang Nhập điểm thủ công</a>

    </div> </div> {% endblock %}